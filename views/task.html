<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8" />
    <title id="windowTitle"></title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <link rel="stylesheet" data-name="vs/editor/editor.main"
        href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/editor/editor.main.min.css">
    <link />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.min.js"></script>
    <link rel="stylesheet" href="/mvp.css" />
    <script src="/components/hamburger.js"></script>
    <script src="/components/navbar.js"></script>
    <link rel="stylesheet" href="/components/hamburger.css" />
</head>

<body style="background-color: #202124;">

    <nav-bar></nav-bar>
    <main style="padding: 0px 30px;">

        <h1 id="taskTitle"></h1>
        <div id="container" style="height:80vh;"></div>
        <button
            style="padding:4px 15px;background-color: greenyellow;border-color: black;border-radius: 4px;margin-top: 20px;"
            id="runBtn">
            Run
        </button>
    </main>
    <script>
        document.querySelector("nav-bar").setAttribute("hide-login", "true")
        var taskId = parseInt('<%= taskId %>');
        fetch("/tasks.json")
            .then(response => response.json())
            .then((tasks) => {
                let task = tasks[taskId]
                document.getElementById("taskTitle").innerHTML = task.title;
                document.getElementById("windowTitle").innerHTML = task.title;
            });
        const model = tf.sequential();

        fetch("/tfjs.d.ts")
            .then(response => response.text())
            .then((tfjsSource) => {

                // require is provided by loader.min.js.
                require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs' } });
                require(["vs/editor/editor.main"], () => {
                    monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({
                        noSemanticValidation: true,
                        noSyntaxValidation: false,
                    });

                    // compiler options
                    monaco.languages.typescript.javascriptDefaults.setCompilerOptions({
                        target: monaco.languages.typescript.ScriptTarget.ES2015,
                        allowNonTsExtensions: true,
                    });


                    var libUri = "ts:filename/tfjs.d.ts";

                    monaco.languages.typescript.javascriptDefaults.addExtraLib(tfjsSource, libUri);
                    monaco.editor.createModel(tfjsSource, "typescript", monaco.Uri.parse(libUri));

                    let defaultCode = `
// Define a model for linear regression.
const model = tf.sequential();
model.add(tf.layers.dense({units: 1, inputShape: [1]}));

model.compile({loss: 'meanSquaredError', optimizer: 'sgd'});

// Generate some synthetic data for training.
const xs = tf.tensor2d([1, 2, 3, 4], [4, 1]);
const ys = tf.tensor2d([1, 3, 5, 7], [4, 1]);

// Train the model using the data.
model.fit(xs, ys, {epochs: 10}).then(() => {
// Use the model to do inference on a data point the model hasn't seen before:
model.predict(tf.tensor2d([5], [1, 1])).print();
// Open the browser devtools to see the output
});
                    `

                    window.editor = monaco.editor.create(document.getElementById("container"), {
                        value: defaultCode,
                        language: "javascript",
                        theme: "vs-dark"
                    });

                    //setup run button
                    document.getElementById("runBtn").addEventListener("click", () => {
                        console.log(eval(window.editor.getValue()))
                    })
                });
            });
    </script>
</body>

</html>